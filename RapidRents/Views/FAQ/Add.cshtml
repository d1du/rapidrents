@model Sabio.Web.Models.ViewModels.ItemViewModel<int?>
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

@section styles {
    <style type="text/css">
        .faqMgnBtmSm {
            padding-bottom: 15px;
        }
    </style>
}

@Styles.Render("~/Content/faq.css")
<form id="sample-form" role="form" class="col-md-6">
    <div class="panel col-md-11">
        <div class="formHeading"><center><h3>New FAQ</h3></center></div>
        <hr />
        <div class="panel col-md-12">
            <div class="faqMgnBtmSm">
                <div class="elementPadding" style="padding-top: 10px;">
                    <label for="question">Enter your question:</label>
                    <input type="text" class="form-control" id="question" name="question" placeholder="What is there to do in the Culver City area?">
                </div>
            </div>
            <div class="faqMgnBtmSm">
                <div class="elementPadding">
                    <label for="category">Category</label>
                    <select class="form-control" id="category" name="category">
                        <option disabled selected>--Select an option--</option>
                        <option value="1">Price</option>
                        <option value="2">Reviews</option>
                        <option value="3">User</option>
                        <option value="4">Location</option>
                    </select>
                </div>
            </div>

            <div class="faqMgnBtmSm">
                <div class="elementPadding">
                    <label for="answer">Enter your answer:</label>
                    <textarea class="form-control" rows="6" id="answer" name="answer"></textarea>
                    <div class="successMessage"></div>
                    <div class="buttonPadding">
                        <button type="submit" id="submitFAQ" class="btn btn-primary">Submit</button>
                        <div class="buttonDivider"></div>
                        <button type="button" id="deleteFAQ" class="hidden">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

@section Scripts {
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/sabio.services.faq.js" type="text/javascript"></script>
    <script src="~/Scripts/sabio.services.analytics.js" type="text/javascript"></script>

    <script type="text/javascript">
        sabio.page.startUp = function () {
            sabio.page.initializeValidation();
            sabio.page.editEntry(@Model.Item);
            $("#submitFAQ").on("click", sabio.page.handlers.onSampleFormSubmit);
            $("#deleteFAQ").on("click", sabio.page.handlers.onDelete);

        };

        sabio.page.initializeValidation = function () {

            jQuery.validator.setDefaults({
                debug: true
            });

            $('#sample-form').validate({
                rules: {
                    "question": {
                        required: true,
                        minlength: 10
                    },
                    "answer": {
                        required: true,
                        minlength: 3
                    },
                    "category": {
                        required: true
                    }
                },

                messages: {
                    "question": {
                        required: "This cannot be blank.",
                        minlength: "Question must be 10 or more characters."
                    },
                    "answer": {
                        required: "This cannot be blank.",
                        minlength: "Answer must be 3 ore more characters."
                    },
                    "category": {
                        required: "Please select a category from the dropdown box."
                    }
                }
            });
        };

        sabio.page.handlers.onSampleFormSubmit = function () {
            if ($('#sample-form').valid()) {
                var myData = $("#sample-form").serialize();
                if (!sabio.page.currentId) {
                    sabio.services.faq.add(myData, sabio.page.insertAjaxSuccess, sabio.page.insertAjaxError);
                    $(".successMessage").html("Entry successfully submitted!");
                    $("#deleteFAQ").attr("class", "btn btn-default");
                }
                else {
                    var editData = myData + "&id=" + sabio.page.currentId;
                    sabio.services.faq.update(sabio.page.currentId, editData, sabio.page.updateAjaxSuccess, sabio.page.updateAjaxError);
                    $(".successMessage").html("Entry successfully edited!")
                }
            }
        };

        sabio.page.handlers.onDelete = function () {
            if (confirm('Are you sure you want to delete entry ' + sabio.page.currentId + '?')) {
                sabio.services.faq.delete(sabio.page.currentId, sabio.page.deleteAjaxSuccess, sabio.page.deleteAjaxError);
                setTimeout(function () {
                    window.location = "/faqs/add";
                }, 1000);
            }
            else {
                return;
            }
        }

        sabio.page.insertAjaxSuccess = function (data) {
            sabio.page.currentId = data.item;
            sabio.page.editChange(sabio.page.currentId);
            console.log("Insert was successful!");
        }

        sabio.page.updateAjaxSuccess = function () {
            console.log("UPDATE ENTRY was successful!");
        }

        sabio.page.editAjaxSuccess = function (data) {
            if (data.item === null) {
                window.location = "/faqs/errorpage";
            }
            $("#question").val(data.item.question);
            $("#category").val(data.item.category);
            $("#answer").val(data.item.answer);
            sabio.page.currentId = data.item.id;
            sabio.page.editChange(sabio.page.currentId);
        }

        sabio.page.deleteAjaxSuccess = function () {
            $("#sample-form").trigger("reset");
            $(".successMessage").html("Entry successfully deleted!");
        }

        sabio.page.insertAjaxError = function () {
            console.log(":(");
        }

        sabio.page.updateAjaxError = function () {
            console.log("=(");
        }

        sabio.page.editAjaxError = function () {
            console.log("x(");
        }

        sabio.page.deleteAjaxError = function () {
            console.log("X_X");
        }

        sabio.page.editEntry = function (id) {
            if (id) {
                sabio.services.faq.getEdit(id, sabio.page.editAjaxSuccess, sabio.page.editAjaxError);
            }
        }

        sabio.page.editChange = function (id) {
            $("#submitFAQ").html("Edit").attr("class", "btn btn-info");
            $("h4").html("Entry " + id);
            $("#deleteFAQ").attr("class", "btn btn-default");
        }
    </script>
}